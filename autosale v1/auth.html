<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoSale - Đăng Nhập/Đăng Ký</title>
    <link rel="stylesheet" href="assets/css/auth.css">
</head>
<body>
    <!-- Header giống trang chủ -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1><a href="index.html">AutoSale</a></h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">Trang Chủ</a>
                <a href="cars.html" class="nav-link">Xe Bán</a>
                <a href="contact.html" class="nav-link">Liên Hệ</a>
            </nav>
        </div>
    </header>

    <!-- Container chính cho form đăng nhập/đăng ký -->
    <main class="auth-container">
        <div class="auth-wrapper">
            <!-- Form đăng nhập -->
            <div class="auth-form" id="loginForm">
                <h2>Đăng Nhập</h2>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Mật khẩu:</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <button type="submit" class="auth-btn">Đăng Nhập</button>
                </form>
                <p class="switch-form">
                    Chưa có tài khoản? 
                    <a href="#" id="showRegister">Đăng ký ngay</a>
                </p>
            </div>

            <!-- Form đăng ký -->
            <div class="auth-form hidden" id="registerForm">
                <h2>Đăng Ký</h2>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerName">Họ tên:</label>
                        <input type="text" id="registerName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email:</label>
                        <input type="email" id="registerEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPhone">Số điện thoại:</label>
                        <input type="tel" id="registerPhone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Mật khẩu:</label>
                        <input type="password" id="registerPassword" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Xác nhận mật khẩu:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Đăng Ký</button>
                </form>
                <p class="switch-form">
                    Đã có tài khoản? 
                    <a href="#" id="showLogin">Đăng nhập</a>
                </p>
            </div>
        </div>
    </main>

    <!-- Thông báo -->
    <div id="notification" class="notification hidden"></div>

    <!-- JavaScript để xử lý đăng nhập/đăng ký và localStorage -->
    <script>
        // Lấy các element cần thiết từ DOM
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterBtn = document.getElementById('showRegister');
        const showLoginBtn = document.getElementById('showLogin');
        const loginFormElement = document.getElementById('loginFormElement');
        const registerFormElement = document.getElementById('registerFormElement');
        const notification = document.getElementById('notification');

        // Hàm chuyển đổi giữa form đăng nhập và đăng ký
        showRegisterBtn.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        });

        showLoginBtn.addEventListener('click', function(e) {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        // Hàm hiển thị thông báo
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            
            // Tự động ẩn thông báo sau 3 giây
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Xử lý đăng ký tài khoản
        registerFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Lấy dữ liệu từ form
            const formData = new FormData(this);
            const userData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword')
            };

            // Kiểm tra mật khẩu xác nhận
            if (userData.password !== userData.confirmPassword) {
                showNotification('Mật khẩu xác nhận không khớp!', 'error');
                return;
            }

            // Kiểm tra email đã tồn tại chưa
            const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
            if (existingUsers.find(user => user.email === userData.email)) {
                showNotification('Email đã được sử dụng!', 'error');
                return;
            }

            // Lưu user mới vào localStorage
            existingUsers.push({
                name: userData.name,
                email: userData.email,
                phone: userData.phone,
                password: userData.password,
                registeredAt: new Date().toISOString()
            });
            
            localStorage.setItem('users', JSON.stringify(existingUsers));
            showNotification('Đăng ký thành công!', 'success');
            
            // Chuyển về form đăng nhập
            setTimeout(() => {
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                registerFormElement.reset();
            }, 1500);
        });

        // Xử lý đăng nhập
        loginFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Lấy dữ liệu từ form
            const formData = new FormData(this);
            const loginData = {
                email: formData.get('email'),
                password: formData.get('password')
            };

            // Kiểm tra thông tin đăng nhập
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === loginData.email && u.password === loginData.password);

            if (user) {
                // Lưu thông tin đăng nhập vào localStorage
                localStorage.setItem('currentUser', JSON.stringify({
                    name: user.name,
                    email: user.email,
                    phone: user.phone,
                    loginTime: new Date().toISOString()
                }));
                
                showNotification('Đăng nhập thành công!', 'success');
                
                // Chuyển hướng về trang chủ sau 1.5 giây
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } else {
                showNotification('Email hoặc mật khẩu không đúng!', 'error');
            }
        });

        // Kiểm tra nếu user đã đăng nhập thì chuyển hướng về trang chủ
        if (localStorage.getItem('currentUser')) {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
